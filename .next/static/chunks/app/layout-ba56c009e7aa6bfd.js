(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{63:(e,t,s)=>{"use strict";var a=s(7260);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},1442:(e,t,s)=>{"use strict";s.d(t,{default:()=>r});var a=s(5155);function r(){return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"relative w-20 h-20 mx-auto mb-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 border-4 border-yellow-400/20 rounded-full"}),(0,a.jsx)("div",{className:"absolute inset-0 border-4 border-yellow-400 rounded-full border-t-transparent animate-spin"})]}),(0,a.jsx)("p",{className:"text-gray-400 text-lg font-medium",children:"Loading..."})]})})}},1793:(e,t,s)=>{"use strict";s.d(t,{default:()=>m});var a=s(5155),r=s(63),l=s(2115),n=s(2619),o=s.n(n),i=s(5171);let c=()=>{var e,t;let s=(0,r.usePathname)(),n=(0,r.useRouter)(),[c,d]=(0,l.useState)(new Date().toLocaleTimeString()),[m,u]=(0,l.useState)(null),[x,h]=(0,l.useState)(!0),[g,b]=(0,l.useState)(!1),f=(0,i.Y)();(0,l.useEffect)(()=>{let e=setInterval(()=>{d(new Date().toLocaleTimeString())},1e3);return()=>clearInterval(e)},[]),(0,l.useEffect)(()=>{fetch("/api/auth/me").then(e=>e.json()).then(e=>{e.user&&u(e.user)}).catch(e=>console.error("Error fetching user:",e)).finally(()=>h(!1))},[]);let p=async()=>{try{await fetch("/api/auth/logout",{method:"POST"}),n.push("/login"),n.refresh()}catch(e){console.error("Logout error:",e)}},v=[{name:"Overview",href:"/",icon:"\uD83D\uDCCA",roles:["admin"]},{name:"Users",href:"/users",icon:"\uD83D\uDC65",roles:["admin","developer"]},{name:"Plans",href:"/plans",icon:"\uD83D\uDC8E",roles:["admin"]},{name:"Tickets",href:"/tickets",icon:"\uD83C\uDFAB",roles:["admin","developer","support"]},{name:"Chat",href:"/chat",icon:"\uD83D\uDCAC",roles:["admin","developer","support"]},{name:"Analytics",href:"/analytics",icon:"\uD83D\uDCC8",roles:["admin"]},{name:"Admin Panel",href:"/admin-panel",icon:"\uD83D\uDC51",roles:["admin"]}],y=m?v.filter(e=>e.roles.includes(m.role)):v;return(0,a.jsxs)("nav",{className:"w-72 min-w-72 max-w-72 glass-effect border-r border-gray-800/50 p-6 sticky top-0 h-screen overflow-y-auto flex-shrink-0",children:[(0,a.jsx)("div",{className:"mb-10 pb-6 border-b border-gray-800/50",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-yellow-400 to-yellow-600 flex items-center justify-center shadow-lg shadow-yellow-400/20",children:(0,a.jsx)("span",{className:"text-xl font-bold text-black",children:"3V"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold gradient-text",children:"3VLTN"}),(0,a.jsx)("p",{className:"text-gray-500 text-xs font-medium",children:"Admin Dashboard"})]})]})}),(0,a.jsxs)("div",{className:"space-y-1 mb-8",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider px-4 mb-3",children:"Navigation"}),(0,a.jsx)("ul",{className:"space-y-1",children:y.map(e=>{let t=s===e.href,r="/chat"===e.href&&(null==f?void 0:f.unreadCount)?f.unreadCount:0;return(0,a.jsx)("li",{children:(0,a.jsxs)(o(),{href:e.href,onClick:e=>{t||(b(!0),setTimeout(()=>b(!1),500))},className:"flex items-center space-x-3 px-4 py-3.5 rounded-xl transition-all duration-200 group relative overflow-hidden ".concat(t?"bg-gradient-to-r from-yellow-400 to-yellow-500 text-black font-semibold shadow-lg shadow-yellow-400/30":"text-gray-300 hover:bg-gray-800/60 hover:text-white"),children:[t&&(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-yellow-300 to-yellow-400 opacity-0 group-hover:opacity-20 transition-opacity duration-200"}),(0,a.jsx)("span",{className:"text-xl transition-transform duration-200 ".concat(t?"scale-110":"group-hover:scale-110"),children:e.icon}),(0,a.jsxs)("span",{className:"relative flex items-center gap-2",children:[e.name,r>0&&(0,a.jsx)("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full font-bold min-w-[20px] text-center",children:r>99?"99+":r})]})]})},e.name)})})]}),(0,a.jsxs)("div",{className:"mt-auto space-y-4",children:[!x&&m&&(0,a.jsx)("div",{className:"border-t border-gray-800/50 pt-4",children:(0,a.jsxs)("div",{className:"bg-gradient-to-br from-gray-800/40 to-gray-900/40 rounded-xl p-4 backdrop-blur-sm border border-gray-700/30",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg",children:(0,a.jsx)("span",{className:"text-white font-bold text-sm",children:(null==(t=m.fullName)||null==(e=t[0])?void 0:e.toUpperCase())||"U"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-white truncate",children:m.fullName}),(0,a.jsx)("p",{className:"text-xs text-gray-400 truncate",children:m.email})]})]}),(0,a.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-lg text-xs font-bold ".concat("admin"===m.role?"bg-purple-500/20 text-purple-400":"developer"===m.role?"bg-blue-500/20 text-blue-400":"bg-green-500/20 text-green-400"),children:m.role.toUpperCase()})}),(0,a.jsx)("button",{onClick:p,className:"w-full py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 font-semibold rounded-lg transition-colors text-sm",children:"\uD83D\uDEAA Logout"})]})}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-gray-800/40 to-gray-900/40 rounded-xl p-4 backdrop-blur-sm border border-gray-700/30",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse shadow-lg shadow-green-400/50"}),(0,a.jsx)("span",{className:"text-xs font-semibold text-gray-300",children:"System Online"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Last updated:"}),(0,a.jsx)("p",{className:"text-xs text-gray-400 font-mono",children:c})]})]})]})};var d=s(1442);function m(e){let{children:t}=e,s=(0,r.usePathname)(),[n,o]=(0,l.useState)(null),[m,u]=(0,l.useState)(!1),x=["/login","/register","/track","/complaint"];return((0,l.useEffect)(()=>{x.some(e=>s.startsWith(e))||n||fetch("/api/auth/me").then(e=>e.json()).then(e=>{e.user&&o(e.user)}).catch(e=>console.error("Error fetching user:",e))},[]),(0,l.useEffect)(()=>{u(!0);let e=setTimeout(()=>u(!1),300);return()=>clearTimeout(e)},[s]),x.some(e=>s.startsWith(e)))?(0,a.jsx)("main",{className:"min-h-screen w-full",children:t}):(0,a.jsx)(i.k,{user:n,children:(0,a.jsxs)("div",{className:"flex min-h-screen",children:[(0,a.jsx)(c,{}),(0,a.jsx)("main",{className:"flex-1 p-8 lg:p-10 relative",children:(0,a.jsxs)("div",{className:"max-w-[1600px] mx-auto",children:[m&&(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-[#0a0a0a] to-[#1a1a1a] bg-opacity-50 backdrop-blur-sm z-40 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"relative w-16 h-16 mx-auto mb-3",children:[(0,a.jsx)("div",{className:"absolute inset-0 border-4 border-yellow-400/20 rounded-full"}),(0,a.jsx)("div",{className:"absolute inset-0 border-4 border-yellow-400 rounded-full border-t-transparent animate-spin"})]}),(0,a.jsx)("p",{className:"text-gray-400 text-sm font-medium",children:"Loading..."})]})}),(0,a.jsx)(l.Suspense,{fallback:(0,a.jsx)(d.default,{}),children:t})]})})]})})}},3286:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,3867,23)),Promise.resolve().then(s.t.bind(s,9672,23)),Promise.resolve().then(s.bind(s,1793)),Promise.resolve().then(s.t.bind(s,3673,23))},3673:()=>{},3867:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_188709",variable:"__variable_188709"}},5171:(e,t,s)=>{"use strict";s.d(t,{Y:()=>i,k:()=>o});var a=s(5155),r=s(2115),l=s(9829);let n=(0,r.createContext)();function o(e){let{children:t,user:s}=e,[o,i]=(0,r.useState)(null),[c,d]=(0,r.useState)([]),[m,u]=(0,r.useState)([]),[x,h]=(0,r.useState)({}),[g,b]=(0,r.useState)(!1),[f,p]=(0,r.useState)(0),[v,y]=(0,r.useState)({});(0,r.useEffect)(()=>{if(!(null==s?void 0:s.id))return;console.log("\uD83D\uDCAC Connecting to chat server...");let e=(0,l.Ay)("http://localhost:3001",{transports:["websocket","polling"],withCredentials:!0,reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:5});return e.on("connect",()=>{console.log("✅ Connected to chat server"),b(!0),e.emit("join",{userId:s.id})}),e.on("disconnect",()=>{console.log("❌ Disconnected from chat server"),b(!1)}),e.on("rooms",e=>{console.log("\uD83D\uDCCB Received rooms:",e.length),d(e),p(e.reduce((e,t)=>e+(t.unread_count||0),0))}),e.on("online-users",e=>{console.log("\uD83D\uDC65 Online users:",e.length),u(e)}),e.on("new-message",e=>{let{roomId:t,message:s}=e;console.log("\uD83D\uDCAC New message in room",t),h(e=>({...e,[t]:[...e[t]||[],s]})),p(e=>e+1)}),e.on("user-status",e=>{let{userId:t,status:s}=e;console.log("\uD83D\uDC64 User ".concat(t," is now ").concat(s)),u(e=>e.map(e=>e.id===t?{...e,status:s}:e))}),e.on("user-typing",e=>{let{roomId:t,userId:s,user:a,isTyping:r}=e;y(e=>{let l={...e[t]||{}};return r?l[s]=a:delete l[s],{...e,[t]:l}})}),e.on("message-read",e=>{let{messageId:t,userId:s}=e;console.log("✅ Message ".concat(t," read by user ").concat(s))}),e.on("new-room",e=>{console.log("\uD83C\uDD95 Added to new room:",e.name),d(t=>[...t,e])}),e.on("room-created",e=>{console.log("✨ Room created:",e.name),d(t=>[...t,e])}),e.on("message-edited",e=>{let{messageId:t,roomId:s,message:a}=e;console.log("✏️ Message edited"),h(e=>({...e,[s]:(e[s]||[]).map(e=>e.id===t?{...e,message:a,is_edited:!0}:e)}))}),e.on("message-deleted",e=>{let{messageId:t,roomId:s}=e;console.log("\uD83D\uDDD1️ Message deleted"),h(e=>({...e,[s]:(e[s]||[]).map(e=>e.id===t?{...e,is_deleted:!0,message:"This message was deleted"}:e)}))}),e.on("error",e=>{console.error("❌ Chat error:",e)}),i(e),()=>{console.log("\uD83D\uDD0C Closing chat connection"),e.close()}},[null==s?void 0:s.id]);let j=(0,r.useCallback)(function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text";o&&g&&o.emit("send-message",{roomId:e,message:t,messageType:s})},[o,g]),N=(0,r.useCallback)(e=>{o&&g&&o.emit("create-direct-room",{targetUserId:e})},[o,g]),w=(0,r.useCallback)((e,t,s,a)=>{o&&g&&o.emit("create-room",{name:e,type:t,description:s,memberIds:a})},[o,g]),k=(0,r.useCallback)(e=>{o&&g&&(o.emit("mark-room-read",{roomId:e}),d(t=>t.map(t=>t.id===e?{...t,unread_count:0}:t)),p(t=>{var s;return Math.max(0,t-((null==(s=c.find(t=>t.id===e))?void 0:s.unread_count)||0))}))},[o,g,c]),C=(0,r.useCallback)(e=>{o&&g&&o.emit("typing",{roomId:e,isTyping:!0})},[o,g]),S=(0,r.useCallback)(e=>{o&&g&&o.emit("typing",{roomId:e,isTyping:!1})},[o,g]),_=(0,r.useCallback)((e,t,s)=>{o&&g&&o.emit("edit-message",{messageId:e,newMessage:t,roomId:s})},[o,g]),P=(0,r.useCallback)((e,t)=>{o&&g&&o.emit("delete-message",{messageId:e,roomId:t})},[o,g]),E=(0,r.useCallback)(e=>{o&&g&&o.emit("update-status",{status:e})},[o,g]);return(0,a.jsx)(n.Provider,{value:{socket:o,connected:g,rooms:c,onlineUsers:m,messages:x,unreadCount:f,typingUsers:v,sendMessage:j,createDirectRoom:N,createRoom:w,markRoomAsRead:k,startTyping:C,stopTyping:S,editMessage:_,deleteMessage:P,updateStatus:E,setMessages:h},children:t})}let i=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("useChat must be used within a ChatProvider");return e}},9672:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}}},e=>{e.O(0,[538,619,829,441,255,358],()=>e(e.s=3286)),_N_E=e.O()}]);