(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[742],{53:(e,t,s)=>{Promise.resolve().then(s.bind(s,4786))},63:(e,t,s)=>{"use strict";var r=s(7260);s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},4786:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var r=s(5155),a=s(2115),i=s(2619),n=s.n(i),l=s(63),o=s(8430);function c(e){if(!e)return"";let t=e.split("\n"),s=[],r=!1;for(let e=0;e<t.length;e++){let a=t[e],i=a.trim();if(0!==s.length||i){if(("wrote:"===i||i.startsWith("wrote:"))&&s.length>0){let e=s[s.length-1].trim();if(e.includes("<")&&e.includes("@")&&e.includes(">")){s.pop(),s.length>0&&s[s.length-1].trim().startsWith("On ")&&s.pop(),r=!0;break}}if((i.startsWith("On ")||i.startsWith("on "))&&(i.includes("wrote:")||i.includes("escribi\xf3:")||i.includes("schrieb:")||i.includes("\xe9crit :"))){r=!0;break}if((i.startsWith("On ")||i.startsWith("on "))&&i.includes("<")&&i.includes("@")&&i.includes(">")&&e+1<t.length){let s=t[e+1].trim();if("wrote:"===s||s.startsWith("wrote:")){r=!0;break}}if(i.includes("<")&&i.includes("@")&&i.includes(">")&&e+1<t.length&&t[e+1].trim().includes("wrote:")){r=!0;break}if(i.startsWith(">")){r=!0;continue}if("--"===i||"---"===i||(i.startsWith("Best regards")||i.startsWith("Regards")||i.startsWith("Thanks")||i.startsWith("Thank you")||i.startsWith("Sincerely")||i.startsWith("Sent from"))&&t.slice(e).join("").trim().length<100)break;!(i.startsWith("Ticket ID:")||i.startsWith("Ticket #")||i.match(/^TICK-\d{8}-[A-Z0-9]+$/))&&(r||s.push(a))}}let a=s.join("\n").trim();return a.replace(/\n{3,}/g,"\n\n")}function d(e){let{params:t}=e;(0,l.useRouter)();let s=(0,a.use)(t).ticketId,[i,d]=(0,a.useState)(null),[h,m]=(0,a.useState)(!0),[x,u]=(0,a.useState)(!1),[p,g]=(0,a.useState)(""),[f,y]=(0,a.useState)(!1);async function b(){m(!0);try{let e=await (0,o.hn)(s);d(e.data)}catch(e){console.error("Error loading ticket:",e)}finally{m(!1)}}async function j(e){u(!0);try{await (0,o.EZ)(s,{status:e}),await b()}catch(e){alert("Failed to update status: "+e.message)}finally{u(!1)}}async function w(e){u(!0);try{await (0,o.EZ)(s,{priority:e}),await b()}catch(e){alert("Failed to update priority: "+e.message)}finally{u(!1)}}async function v(e){if(e.preventDefault(),!p.trim())return void alert("Please enter a message");y(!0);try{await (0,o.ZC)(s,p),g(""),await b(),alert("Reply sent successfully!")}catch(e){alert("Failed to send reply: "+e.message)}finally{y(!1)}}return((0,a.useEffect)(()=>{b()},[s]),h)?(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsx)("div",{className:"shimmer h-32 rounded-2xl"}),(0,r.jsx)("div",{className:"shimmer h-64 rounded-2xl"})]}):i?(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)(n(),{href:"/tickets",className:"inline-flex items-center space-x-2 text-yellow-400 hover:text-yellow-300 transition-colors",children:[(0,r.jsx)("span",{children:"←"}),(0,r.jsx)("span",{className:"font-semibold",children:"Back to Tickets"})]}),(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-900/80 to-gray-900/40 backdrop-blur-sm border border-gray-800/50 rounded-2xl p-8",children:[(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:i.subject}),(0,r.jsxs)("p",{className:"text-gray-400 font-mono text-sm",children:["Ticket ID: ",i.ticket_id]})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,r.jsxs)("select",{value:i.status,onChange:e=>j(e.target.value),disabled:x,className:"px-4 py-2 bg-gray-800/60 border border-gray-700/50 rounded-xl text-white focus:outline-none focus:border-yellow-400 transition-all",children:[(0,r.jsx)("option",{value:"open",children:"Open"}),(0,r.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,r.jsx)("option",{value:"resolved",children:"Resolved"}),(0,r.jsx)("option",{value:"closed",children:"Closed"})]}),(0,r.jsxs)("select",{value:i.priority,onChange:e=>w(e.target.value),disabled:x,className:"px-4 py-2 bg-gray-800/60 border border-gray-700/50 rounded-xl text-white focus:outline-none focus:border-yellow-400 transition-all",children:[(0,r.jsx)("option",{value:"low",children:"Low"}),(0,r.jsx)("option",{value:"medium",children:"Medium"}),(0,r.jsx)("option",{value:"high",children:"High"}),(0,r.jsx)("option",{value:"urgent",children:"Urgent"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 p-6 bg-gray-800/30 rounded-xl",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400 text-sm font-medium",children:"Customer Email"}),(0,r.jsx)("p",{className:"font-semibold text-white mt-1",children:i.email})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400 text-sm font-medium",children:"Status"}),(0,r.jsx)("p",{className:"font-semibold text-white mt-1 capitalize",children:i.status.replace("_"," ")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400 text-sm font-medium",children:"Priority"}),(0,r.jsx)("p",{className:"font-semibold text-white mt-1 capitalize",children:i.priority})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400 text-sm font-medium",children:"Assigned To"}),i.assigned_agent_name?(0,r.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,r.jsx)("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-yellow-400 to-yellow-600 flex items-center justify-center text-black font-bold text-xs flex-shrink-0",children:i.assigned_agent_name.split(" ").map(e=>e[0]).join("").toUpperCase()}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold text-white text-sm",children:i.assigned_agent_name}),(0,r.jsx)("p",{className:"text-xs text-gray-400",children:i.assigned_agent_role})]})]}):(0,r.jsx)("p",{className:"text-gray-500 italic mt-1",children:"Unassigned"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400 text-sm font-medium",children:"Created"}),(0,r.jsx)("p",{className:"font-semibold text-white mt-1",children:new Date(i.created_at).toLocaleString()})]})]})]}),(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-900/80 to-gray-900/40 backdrop-blur-sm border border-gray-800/50 rounded-2xl p-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-white mb-6",children:"Conversation"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"bg-blue-500/10 border-l-4 border-blue-500 rounded-xl p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-blue-400 text-sm",children:"Customer"}),(0,r.jsxs)("span",{className:"text-gray-400 text-sm ml-2",children:["(",i.email,")"]})]}),(0,r.jsx)("span",{className:"text-gray-500 text-xs",children:new Date(i.created_at).toLocaleString()})]}),(0,r.jsx)("div",{className:"text-gray-200 whitespace-pre-wrap leading-relaxed",children:c(i.message)})]}),(()=>{let e=(i.messages||[]).filter((e,t)=>0!==t||!e.is_from_customer||Math.abs(new Date(e.created_at).getTime()-new Date(i.created_at).getTime())>1e3);return e.length>0?e.map((e,t)=>(0,r.jsxs)("div",{className:"".concat(e.is_from_customer?"bg-blue-500/10 border-l-4 border-blue-500":"bg-green-500/10 border-l-4 border-green-500"," rounded-xl p-6"),children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-sm ".concat(e.is_from_customer?"text-blue-400":"text-green-400"),children:e.is_from_customer?"Customer":"Support Team"}),(0,r.jsxs)("span",{className:"text-gray-400 text-sm ml-2",children:["(",e.from_email||i.email,")"]})]}),(0,r.jsx)("span",{className:"text-gray-500 text-xs",children:new Date(e.created_at).toLocaleString()})]}),(0,r.jsx)("div",{className:"text-gray-200 whitespace-pre-wrap leading-relaxed",children:c(e.body)})]},t)):(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("span",{className:"text-4xl mb-2 block",children:"\uD83D\uDCAC"}),"No replies yet"]})})()]})]}),(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-900/80 to-gray-900/40 backdrop-blur-sm border border-gray-800/50 rounded-2xl p-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-white mb-6",children:"Send Reply"}),(0,r.jsxs)("form",{onSubmit:v,children:[(0,r.jsx)("textarea",{value:p,onChange:e=>g(e.target.value),placeholder:"Type your response to the customer...",rows:6,className:"w-full bg-gray-800/60 border border-gray-700/50 rounded-xl p-4 text-white placeholder-gray-400 focus:outline-none focus:border-yellow-400 focus:ring-2 focus:ring-yellow-400/20 transition-all mb-4",disabled:f}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("button",{type:"submit",disabled:f||!p.trim(),className:"px-6 py-3 bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-black font-bold rounded-xl transition-all duration-200 shadow-lg shadow-yellow-400/30 hover:shadow-yellow-400/50 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:f?"Sending...":"\uD83D\uDCE7 Send Reply"})})]})]})]}):(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("span",{className:"text-6xl",children:"❌"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-white mt-4",children:"Ticket Not Found"}),(0,r.jsx)(n(),{href:"/tickets",className:"text-yellow-400 hover:text-yellow-300 mt-4 inline-block",children:"← Back to Tickets"})]})}},8430:(e,t,s)=>{"use strict";s.d(t,{EZ:()=>n,ZC:()=>l,ey:()=>o,hn:()=>i,oP:()=>a});let r="http://localhost:3001";async function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;e.status&&t.append("status",e.status),e.priority&&t.append("priority",e.priority),e.email&&t.append("email",e.email),e.assigned_to&&t.append("assigned_to",e.assigned_to),e.page&&t.append("page",e.page),e.limit&&t.append("limit",e.limit||"10");let s="".concat(r,"/api/tickets").concat(t.toString()?"?"+t.toString():"");try{let e=await fetch(s,{cache:"no-store",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Failed to fetch tickets");return e.json()}catch(e){return console.error("Error fetching tickets:",e),{data:[],pagination:{page:1,pages:1,total:0,limit:10}}}}async function i(e){try{let t=await fetch("".concat(r,"/api/tickets/").concat(e),{cache:"no-store",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("Failed to fetch ticket");return t.json()}catch(e){throw console.error("Error fetching ticket:",e),e}}async function n(e,t){try{let s=await fetch("".concat(r,"/api/tickets/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw Error("Failed to update ticket");return s.json()}catch(e){throw console.error("Error updating ticket:",e),e}}async function l(e,t){try{let s=await fetch("".concat(r,"/api/tickets/").concat(e,"/reply"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t})});if(!s.ok)throw Error("Failed to send reply");return s.json()}catch(e){throw console.error("Error sending reply:",e),e}}async function o(){try{let e=await fetch("".concat(r,"/api/assignments/eligible-agents"),{cache:"no-store",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Failed to fetch agents");return e.json()}catch(e){return console.error("Error fetching agents:",e),{agents:[]}}}}},e=>{e.O(0,[619,441,255,358],()=>e(e.s=53)),_N_E=e.O()}]);